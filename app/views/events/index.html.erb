<div class="container">

  <h1>Events</h1>

  <% if user_signed_in? && current_user == 'admin' %>
    <%= link_to 'New Event', new_event_path, class:'btn btn-secondary' %>
  <% end %>

<div class="container">
  <div id="calendar"></div>
</div>

  <%= render 'modal' %>

  <script>
    $('#calendar').fullCalendar({
      events: '<%= events_path %>',
      eventClick: function(calEvent, jsEvent, view) {
        $('.modal').modal()
      },
      // limit editable attr with cancancan ****
      editable: true,
      // limit editable attr with cancancan ****
      eventDrop: function(event, delta, revertFunc, jsEvent, ui, view) {
        if (!confirm(event.title + " fue movido al " + event.start.calendar() + "\n ¿Estás seguro de mover el evento a esta fecha?")) {
          revertFunc();
        }
        $.ajax({
          url: '/events/' + event.id,
          type: 'PATCH',
          dataType: 'json',
          data: {event: {
            start: event.start.format()},
            authenticity_token: "<%= form_authenticity_token %>"
          }
        })
        .done(function() {
          console.log("success");
        })
        .fail(function() {
          console.log("error");
        })
        .always(function() {
          console.log("complete");
        });

      }
    });
  </script>

</div>
